version: '2.1'
services:
  univaultoffice-documentserver:
    container_name: univaultoffice-documentserver
    build:
      context: ../.
    depends_on:
      - univaultoffice-graphite
    environment:
      - METRICS_ENABLED=${METRICS_ENABLED:-true}
      - METRICS_HOST=${METRICS_HOST:-localhost}
      - METRICS_PORT=${METRICS_PORT:-8125}
      - METRICS_PREFIX=${METRICS_PREFIX:-ds.}
    stdin_open: true
    restart: always
    expose:
      - '2003'
    ports:
      - '80:80'
    volumes:
      - ./graphite/statsd:/var/www/univaultoffice/documentserver/server/Metrics/config

  univaultoffice-graphite:
    container_name: univaultoffice-graphite
    image: graphiteapp/graphite-statsd
    environment:
      - GRAPHITE_STATSD_HOST=${GRAPHITE_STATSD_HOST:-univaultoffice-documentserver}
      - GRAPHITE_TIME_ZONE=${GRAPHITE_TIME_ZONE:-Etc/UTC}
    ports:
      - '8888:80'
    stdin_open: true
    restart: always
